<!DOCTYPE html>
<html>
  <head>
    <title>DEK Demo</title>
    <link rel="shortcut icon" href="public/images/dekfavicon.ico">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="public/css/jquery-ui.css">
    <link rel="stylesheet" href="public/css/style.css">
    <script src="public/js/jquery-1.12.4.js"></script>
    <script src="public/js/jquery-ui.js"></script>
    <script>
     $(function () {
         $("#tabs").tabs();
     });
    </script>
    <script>
     $(document).ready(init);

     function init() {
         if (!("WebSocket" in window)) {
             $('#wsstatus').append('<p><span style="color: red;">Your web browser does not support WebSocket</span></p>');
             $("#navigation").hide();
         } else {
             $('#wsstatus').append('<p><span style="color: green;">Your web browser support WebSocket</span></p>');
             main();
         };
     };

     function main() {
         var WebSocket = window.WebSocket || window.MozWebSocket;
         var wsURL = "ws://" + window.location.hostname + ":{{ ws_port }}/websocket";
         socket = new WebSocket(wsURL);
         // wait for socket to open
         socket.onopen = function () {
             $('input#message').on('keypress', function (event) {
                 if (event.which == 13) {
                     event.preventDefault();
                     if (socket.readyState == socket.OPEN) {
                         var msg = $(this).val();
                         socket.send(msg);
                     }
                     $(this).val("");
                 }
             });
             socket.onmessage = function (msg)
             {
                 var message = $.parseJSON(msg.data);
                 var dest = message.dest;
                 if (dest == 'ping' || dest == 'reply') {
                     var html = "<b>***</b> " + message.msg + "<br>\n" + $('div#' + dest).html();
                     $('div#' + dest).html(html);
                 }
                 else if (dest == 'status') {
                     $('div#wsstatus').html(message.msg + "<br>" + $('div#wsstatus').html());
                     $('div#status').html("Server process ID is: " + message.math);
                 }
                 else console.log(message);
             }
         }
     };

     function add_tab () {
         var num_tabs = $("div#tabs ul li").length + 1;
         $("div#tabs ul").append(
             "<li><a href='#tab" + num_tabs + "'>#" + num_tabs + "</a></li>"
         );
         $("div#tabs").append(
             "<div id='tab" + num_tabs + "'>#" + num_tabs + "</div>"
         );
         $("div#tabs").tabs("refresh");
     }

     function remove_tab () {
         $("a[href='#tabs-1']").closest("li").remove();
     }

    </script>
  </head>
  <body>
    WELCOME TO DEK DEMO APP<br>
    <a href="logout">Log out</a>
    <div id="wsstatus"></div>
    <div id="tabs">
      <ul>
        <li><a href="#tabs-1">Echo</a></li>
        <li><a href="#tabs-2">Ping</a></li>
        <li><a href="#tabs-3">Phu</a></li>
        <li><a href="#tabs-4">Tien</a></li>
        <li><a href="#tabs-5">Tuan</a></li>
      </ul>
      <div id="tabs-1">
        <div id="navigation">
          <div id="status"></div>
          <h3>Client requests</h3>
          <input type="text" id="message">
          <h3>Server replies</h3>
          <div id="reply"></div>
        </div>
      </div>
      <div id="tabs-2">
        <div id="ping" style="overflow:hidden;text-overflow:ellipsis;display:-webkit-box;-webkit-line-clamp:50;line-height:16px;max-height:800px;"></div><br>
      </div>
      <div id="tabs-3">
        <p>Lien Tong Phu</p>
      </div>
      <div id="tabs-4">
        <p>Pham Quang Tien</p>
      </div>
      <div id="tabs-5">
        <p>Tran Nhat Tuan</p>
      </div>
    </div>

  </body>
</html>
